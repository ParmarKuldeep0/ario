<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # 1. First, try to serve the request as a file
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  # 2. Then try to serve it as a directory
  RewriteCond %{REQUEST_FILENAME} -d
  # If either above condition matches, serve the request directly
  RewriteRule ^ - [L]
  
  # 3. Handle Next.js static files
  RewriteRule ^_next/(.*)$ _next/$1 [L]
  
  # 4. Handle trailing slashes (if using trailingSlash: true)
  RewriteCond %{REQUEST_URI} ^(.+)/$
  RewriteRule ^ %1 [R=301,L]
  
  # 5. Route all other requests to index.html
  RewriteRule ^(.*)$ index.html [L]
</IfModule>

# Prevent directory listing
Options -Indexes

# Set proper file permissions
<IfModule mod_authz_core.c>
  Require all granted
</IfModule>